language: bash

services:
  - docker

#before_install:
#  - echo -e "machine github.com\n  login $GITHUB_TOKEN" >> ~/.netrc
#  - sudo apt-get update
##  - sudo apt-get install -y jq yq
#
#install:
#  - pip install -r requirements.txt

script:
  - echo "Running Appdome Travis CI Plugin"
    # Pull the pre-built Docker image
  - docker pull galcappdome/travis_plugin:latest
  - ls -l $(pwd)
#  - mkdir -p output files
  - ls -l $(pwd)
  - ls -l $(pwd)/output
  - chmod +x $(pwd)/*
  - ls -l $(pwd)/files
  # Run the Docker container, mount the config.yml, and execute entrypoint.sh
  - docker run -d --name appdome_container -v $(pwd)/config.yml:/appdome/config.yml -v $(pwd)/output:/appdome/output -v $(pwd)/files:/appdome/files galcappdome/travis_plugin:latest /bin/bash -c "/appdome/trigger_travis_build.sh"
  - mount
  - ls -l $(pwd)
#  - chown -R travis:travis output files
  - ls -l $(pwd)/output
  - docker wait appdome_container
  - docker logs appdome_container
  - ls -l $(pwd)
  - ls -l $(pwd)/output
  - ls -l $(pwd)/files
  - ls -l ./output


after_success:
  - echo "Build succeeded!"
  - ls -l $(pwd)/output

after_failure:
  - echo "Build failed!"
  - ls -l $(pwd)/output